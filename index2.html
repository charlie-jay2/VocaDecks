<html>
  <head>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  </head>
  <style>
    @font-face {
      font-family: "Panton";
      src: url("./Fonts/Panton.ttf") format("truetype");
      font-weight: normal;
      font-style: normal;
      font-display: swap;
      overflow-y: hidden;
      overflow-x: hidden;
    }
    body {
      background-image: url(./Assets/background.png);
      background-repeat: no-repeat;
      background-size: cover;
      background-position: center;
      font-family: Panton;
    }

    .logo {
      width: 20%;
      height: auto;
      position: relative;
      transform: translateX(-50%);
      left: 50%;
    }

    .line {
      width: 95%;
      height: auto;
      position: relative;
      transform: translateX(-50%);
      margin-top: -1.3%;
      left: 50%;
    }

    .rect1 {
      width: 24%;
      height: auto;
      position: relative;
      transform: translateX(-50%);
      margin-top: 3.5%;
      left: 85%;
    }

    .rect2 {
      width: 50%;
      height: auto;
      position: relative;
      transform: translateX(-50%);
      margin-top: 20%;
      left: 22%;
      z-index: 1; /* lower than texts */
    }

    .tbox {
      width: 35%;
      height: auto;
      position: relative;
      transform: translateX(-50%);
      margin-top: -43%;
      left: 29%;
    }

    /* Make #rectangles the positioning context */
    #rectangles {
      position: relative;
    }

    /* texts absolutely positioned over rect2 */
    .text1 {
      position: absolute;
      top: 46%; /* adjust this value to move vertically */
      left: 34%; /* adjust this value to move horizontally */
      transform: translate(-50%, -50%); /* center at left/top */
      z-index: 10; /* high so it's on top */
      color: white;
      white-space: nowrap; /* optional: prevent wrapping */
    }
    .text2 {
      position: absolute;
      top: 46%; /* adjust this value to move vertically */
      left: 59%; /* adjust this value to move horizontally */
      transform: translate(-50%, -50%); /* center at left/top */
      z-index: 10; /* high so it's on top */
      color: white;
      white-space: nowrap; /* optional: prevent wrapping */
    }
    /* block */
    .blockstxt {
      position: absolute;
      top: 55%; /* adjust this value to move vertically */
      left: 47%; /* adjust this value to move horizontally */
      transform: translate(-50%, -50%); /* center at left/top */
      z-index: 10; /* high so it's on top */
      color: white;
      font-size: 30px;
      white-space: nowrap; /* optional: prevent wrapping */
    }

    .blockspo {
      position: absolute;
      top: 59%; /* adjust this value to move vertically */
      left: 45%; /* adjust this value to move horizontally */
      transform: translate(-50%, -50%); /* center at left/top */
      z-index: 10; /* high so it's on top */
      color: white;
      font-size: 30px;
      white-space: nowrap; /* optional: prevent wrapping */
    }
    .blockspt {
      position: absolute;
      top: 59%; /* adjust this value to move vertically */
      left: 49%; /* adjust this value to move horizontally */
      transform: translate(-50%, -50%); /* center at left/top */
      z-index: 10; /* high so it's on top */
      color: white;
      font-size: 30px;
      white-space: nowrap; /* optional: prevent wrapping */
    }
    /* health */
    .healthtxt {
      position: absolute;
      top: 68%; /* adjust this value to move vertically */
      left: 47%; /* adjust this value to move horizontally */
      transform: translate(-50%, -50%); /* center at left/top */
      z-index: 10; /* high so it's on top */
      color: white;
      font-size: 30px;
      white-space: nowrap; /* optional: prevent wrapping */
    }

    .healthpo {
      position: absolute;
      top: 71%; /* adjust this value to move vertically */
      left: 45%; /* adjust this value to move horizontally */
      transform: translate(-50%, -50%); /* center at left/top */
      z-index: 10; /* high so it's on top */
      color: white;
      font-size: 30px;
      white-space: nowrap; /* optional: prevent wrapping */
    }
    .healthpt {
      position: absolute;
      top: 71%; /* adjust this value to move vertically */
      left: 49%; /* adjust this value to move horizontally */
      transform: translate(-50%, -50%); /* center at left/top */
      z-index: 10; /* high so it's on top */
      color: white;
      font-size: 30px;
      white-space: nowrap; /* optional: prevent wrapping */
    }
    /* damage limit */

    .damageltxt {
      position: absolute;
      top: 77%; /* adjust this value to move vertically */
      left: 47%; /* adjust this value to move horizontally */
      transform: translate(-50%, -50%); /* center at left/top */
      z-index: 10; /* high so it's on top */
      color: white;
      font-size: 30px;
      white-space: nowrap; /* optional: prevent wrapping */
    }

    .damagelpo {
      position: absolute;
      top: 80%; /* adjust this value to move vertically */
      left: 45%; /* adjust this value to move horizontally */
      transform: translate(-50%, -50%); /* center at left/top */
      z-index: 10; /* high so it's on top */
      color: white;
      font-size: 30px;
      white-space: nowrap; /* optional: prevent wrapping */
    }
    .damagelpt {
      position: absolute;
      top: 80%; /* adjust this value to move vertically */
      left: 49%; /* adjust this value to move horizontally */
      transform: translate(-50%, -50%); /* center at left/top */
      z-index: 10; /* high so it's on top */
      color: white;
      font-size: 30px;
      white-space: nowrap; /* optional: prevent wrapping */
    }

    /* target split */

    .targettxt {
      position: absolute;
      top: 85%; /* adjust this value to move vertically */
      left: 47%; /* adjust this value to move horizontally */
      transform: translate(-50%, -50%); /* center at left/top */
      z-index: 10; /* high so it's on top */
      color: white;
      font-size: 30px;
      white-space: nowrap; /* optional: prevent wrapping */
    }

    .targetpo {
      position: absolute;
      top: 88%; /* adjust this value to move vertically */
      left: 45%; /* adjust this value to move horizontally */
      transform: translate(-50%, -50%); /* center at left/top */
      z-index: 10; /* high so it's on top */
      color: white;
      font-size: 30px;
      white-space: nowrap; /* optional: prevent wrapping */
    }
    .targetpt {
      position: absolute;
      top: 88%; /* adjust this value to move vertically */
      left: 49%; /* adjust this value to move horizontally */
      transform: translate(-50%, -50%); /* center at left/top */
      z-index: 10; /* high so it's on top */
      color: white;
      font-size: 30px;
      white-space: nowrap; /* optional: prevent wrapping */
    }

    /* Command Lines */
    .cl1 {
      position: absolute;
      top: 44%; /* adjust this value to move vertically */
      left: 27%; /* adjust this value to move horizontally */
      transform: translate(-50%, -50%);
      width: 12%;
      height: 4%;
      background-color: black;
      color: gray;
      font-family: Panton;
      border-radius: 15px;
      border-color: white;
      border-style: solid;
    }

    .cl2 {
      position: absolute;
      top: 91%; /* adjust this value to move vertically */
      left: 85%; /* adjust this value to move horizontally */
      transform: translate(-50%, -50%);
      width: 21%;
      height: 5%;
      background-color: black;
      color: gray;
      font-family: Panton;
      border-radius: 15px;
      border-color: white;
      border-style: solid;
    }

    /* Block Button */

    .blockbt {
      position: absolute;
      top: 44%; /* adjust this value to move vertically */
      left: 67%; /* adjust this value to move horizontally */
      transform: translate(-50%, -50%);
      width: 8%;
      height: 5%;
      background-image: linear-gradient(90deg, #50DBCB, #FFEF3D);
      color: black;
      font-size: 30px;
      font-weight: bolder;
      font-family: Panton;
      border-radius: 15px;
      border-color: white;
      border-width: 3px;
      border-style: solid;
    }  

    .discord {
      position: absolute;
      top: 5%; /* adjust this value to move vertically */
      left: 92%; /* adjust this value to move horizontally */
      transform: translate(-50%, -50%);
      background-color: black;
      color: gray;
      font-family: Panton;
      border-radius: 15px;
      border-color: white;
      border-style: solid;
      transition: 0.6s ease-in-out;
    }

    .discord:hover {
      filter:brightness(0.5);
      scale: calc(0.9);
    }
    </style>
  <body>
    <div id="logoline">
      <img src="./Assets/SERIES_1_LOGO.png" class="logo" />
      <img src="./Assets/ICONS/Line_120.png" class="line" />
    </div>
    <div id="rectangles">
      <img src="./Assets/ICONS/COMMAND_OVERRIDE.png" class="rect1" />
      <img src="./Assets/ICONS/Rectangle_149.png" class="rect2" />
      <img src="./Assets/ICONS/Rectangle_148.png" class="tbox" />
      <div>
        <h1 class="text1">PLAYER ONE</h1>
        <h1 class="text2">PLAYER TWO</h1>
        <!--Blocks-->
        </div>
        <h1 class="blockstxt">BLOCKS</h1>
        <h1 class="blockspo">0</h1>
        <h1 class="blockspt">0</h1>
        </div>
        <!--Health-->
        <h1 class="healthtxt">HEALTH</h1>
        <h1 class="healthpo">0</h1>
        <h1 class="healthpt">0</h1>
        <!--Damage Limit-->
        <h1 class="damageltxt">DAMAGE L</h1>
        <h1 class="damagelpo">0</h1>
        <h1 class="damagelpt">0</h1>

        <!--Target Split-->
        <h1 class="targettxt">TARGET S</h1>
        <h1 class="targetpo">0</h1>
        <h1 class="targetpt">0</h1>
      </div>
      <!-- Command Lines-->
      <div>
        <form>
          <input type="text" id="lname" name="lname" placeholder="ATTACK... (LIMIT 50)" class="cl1">
          <input type="text" id="lname" name="lname" placeholder="COMMAND..." class="cl2">
        </form>
      </div>
      <!-- Block Button -->
       <div>
        <button class="blockbt">
          BLOCK
        </button>
       </div>
       <!-- Pointer -->
        <!-- <div>
          <img src="./Assets/ICONS/pointer.png">
        </div> -->
    </div>

    <div id="buttons">
      <img
        src="./Assets/ICONS/back.png"
        class="back"
        style="margin-left: 15px; position: relative; bottom: 45px" />
      <img
        src="./Assets/ICONS/Settings.png"
        class="back"
        style="margin-left: 15px; position: relative; bottom:45px" />
      <img src="./Assets/ICONS/DC_LOGIN_BUTTON.png" class="discord">
      </div>
  </body>
  <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>

<script>
  // Helper to get query param
  function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
  }

  // Save token in localStorage with expiry check
  function saveToken(token) {
    localStorage.setItem("discordToken", token);
    localStorage.setItem("discordTokenSavedAt", Date.now());
  }

  // Check if token expired (48 hours)
  function isTokenValid(token) {
    try {
      const decoded = jwt_decode(token);
      // decoded.exp is in seconds, Date.now() in ms
      return decoded.exp * 1000 > Date.now();
    } catch {
      return false;
    }
  }

  function renderLoggedIn(user) {
    const discordBtn = document.querySelector(".discord");
    discordBtn.innerHTML = `
      <img src="https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png?size=64" style="width:32px; height:32px; border-radius:50%; vertical-align:middle; margin-right: 8px;" />
      <span>${user.username}</span>
    `;

    // Add click toggle for logout + userID
    let infoDiv = document.getElementById("discordUserInfo");
    if (!infoDiv) {
      infoDiv = document.createElement("div");
      infoDiv.id = "discordUserInfo";
      infoDiv.style.position = "absolute";
      infoDiv.style.top = "60px";
      infoDiv.style.right = "10px";
      infoDiv.style.background = "rgba(0,0,0,0.8)";
      infoDiv.style.color = "white";
      infoDiv.style.padding = "10px";
      infoDiv.style.borderRadius = "10px";
      infoDiv.style.display = "none";
      infoDiv.style.zIndex = "100";
      document.body.appendChild(infoDiv);
    }

    infoDiv.innerHTML = `
      <div>UserID: ${user.id}</div>
      <button id="logoutBtn">Logout</button>
    `;

    discordBtn.onclick = () => {
      infoDiv.style.display = infoDiv.style.display === "none" ? "block" : "none";
    };

    document.getElementById("logoutBtn").onclick = () => {
      localStorage.removeItem("discordToken");
      localStorage.removeItem("discordTokenSavedAt");
      infoDiv.style.display = "none";
      location.reload();
    };
  }

  function renderLoggedOut() {
    const discordBtn = document.querySelector(".discord");
    discordBtn.innerHTML = `<img src="./Assets/ICONS/DC_LOGIN_BUTTON.png" alt="Discord Login" />`;
    discordBtn.onclick = () => {
      window.location.href = "/.netlify/functions/auth-discord";
    };
  }

  // Main flow
  (function () {
    const urlToken = getQueryParam("token");
    if (urlToken) {
      saveToken(urlToken);
      // Remove token from URL so it doesn't persist in history
      history.replaceState(null, null, location.pathname);
    }

    const token = localStorage.getItem("discordToken");

    if (token && isTokenValid(token)) {
      // decode token and show logged in UI
      const user = jwt_decode(token);
      renderLoggedIn(user);
    } else {
      renderLoggedOut();
    }
  })();
</script>

</html>
